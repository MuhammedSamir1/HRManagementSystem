using FluentValidation;
using HRManagementSystem.Features.ConfigurationsManagement.PayrollManagement.PayrollItemManagement.AddPayrollItem.Commands;

namespace HRManagementSystem.Features.ConfigurationsManagement.PayrollManagement.PayrollItemManagement.AddPayrollItem
{
    public class AddPayrollItemCommandValidator : AbstractValidator<AddPayrollItemCommand>
    {
        public AddPayrollItemCommandValidator()
        {

            RuleFor(x => x.Name)
                .NotEmpty().WithMessage("??? ????? ??? ????? ??????.")
                .MinimumLength(3).WithMessage("??? ?? ???? ????? ??? ????? 3 ????.")
                .MaximumLength(100).WithMessage("????? ?? ??? ?? ?????? 100 ???.");


            RuleFor(x => x.Type)
                .IsInEnum().WithMessage("??? ????? ??????? ??? ????.");

            RuleFor(x => x.CalculationType)
                .IsInEnum().WithMessage("??? ?????? ??????? ??? ????.");


            RuleFor(x => x.Value)
                .GreaterThan(0).WithMessage("??? ?? ???? ?????? ???? ?? ?????.");


            When(x => x.CalculationType == CalculationType.PercentageOfBaseSalary, () =>
            {

                RuleFor(x => x.Value)
                    .InclusiveBetween(0.0001m, 1m)
                    .WithMessage("??? ??? ??? ?????? ???? ?????? ??? ?? ???? ?????? ??????? ??? 0.0001 ? 1.0.");


                RuleFor(x => x.Value)
                    .Must(v => v * 10000 % 1 == 0)
                    .WithMessage("??? ?? ???? ???? ?????? ??????? ????? ??? ???? 4 ????? ?????.");
            });

            // 5. ????? ????? ?????? ??????? (Fixed Amount)
            When(x => x.CalculationType == CalculationType.FixedAmount, () =>
            {

                RuleFor(x => x.Value)
                    .Must(v => v * 100 % 1 == 0)
                    .WithMessage("?????? ??????? ??? ?? ???? ??? ???? ??????? ??????? (???? ?????).");
            });
        }
    }
}
