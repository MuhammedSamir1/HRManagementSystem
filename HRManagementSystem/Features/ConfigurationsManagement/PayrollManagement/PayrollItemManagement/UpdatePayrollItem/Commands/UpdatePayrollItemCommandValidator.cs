using FluentValidation;

namespace HRManagementSystem.Features.ConfigurationsManagement.PayrollManagement.PayrollItemManagement.UpdatePayrollItem.Commands
{
    public class UpdatePayrollItemCommandValidator : AbstractValidator<UpdatePayrollItemCommand>
    {
        public UpdatePayrollItemCommandValidator()
        {
            RuleFor(x => x.Id)
                .NotEmpty().WithMessage(" ???? ?????? ??? ????.")
                .NotEqual(Guid.Empty).WithMessage(" ???? ?????? ??? ????.");

            RuleFor(x => x.Name)
                .NotEmpty().WithMessage("??? ????? ??? ????? ??????.")
                .MinimumLength(3).WithMessage("??? ?? ???? ????? ??? ????? 3 ????.")
                .MaximumLength(100).WithMessage("????? ?? ??? ?? ?????? 100 ???.");

            RuleFor(x => x.Type)
                .IsInEnum().WithMessage("??? ????? ??????? ??? ????.");

            RuleFor(x => x.CalculationType)
                .IsInEnum().WithMessage("??? ?????? ??????? ??? ????.");


            RuleFor(x => x.Value)
                .GreaterThan(0).WithMessage("??? ?? ???? ?????? ???? ?? ?????.");

            When(x => x.CalculationType == CalculationType.PercentageOfBaseSalary, () =>
            {
                RuleFor(x => x.Value)
                    .InclusiveBetween(0.0001m, 1m)
                    .WithMessage("??? ??? ??? ?????? ???? ?????? ??? ?? ???? ?????? ??????? ??? 0.0001 ? 1.0.");


                RuleFor(x => x.Value)
                    .Must(v => v * 10000 % 1 == 0)
                    .WithMessage("??? ?? ???? ???? ?????? ??????? ????? ??? ???? 4 ????? ?????.");
            });


            When(x => x.CalculationType == CalculationType.FixedAmount, () =>
            {
                RuleFor(x => x.Value)
                    .Must(v => v * 100 % 1 == 0)
                    .WithMessage("?????? ??????? ??? ?? ???? ??? ???? ??????? ??????? (???? ?????).");
            });
        }
    }
}
